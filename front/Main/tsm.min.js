window.addEventListener("DOMContentLoaded",()=>{const alerts=document.querySelectorAll(".traduire-sans-migraine-alert__title-close");alerts.forEach(alert=>{alert.addEventListener("click",()=>{const parentNode=alert.parentNode.parentNode;parentNode.parentNode.removeChild(parentNode)})})});class Alert{static createNode(title,message,type){const alert=document.createElement("div");alert.classList.add("notice","traduire-sans-migraine-alert",`traduire-sans-migraine-alert-${type}`);alert.innerHTML=`
                ${title?`<div class="traduire-sans-migraine-alert__title">
                    <span class="traduire-sans-migraine-alert__title-text">${title}</span>
                    <span class="traduire-sans-migraine-alert__title-close">X</span>               
                </div>`:""}
                <div class="traduire-sans-migraine-alert__body">${message}</div>
        `;return alert}}function setButtonLoading(buttonSelector){const button=typeof buttonSelector==="string"?document.querySelector(buttonSelector):buttonSelector;button.classList.add("loading");button.setAttribute("disabled","true")}function stopButtonLoading(buttonSelector){const button=typeof buttonSelector==="string"?document.querySelector(buttonSelector):buttonSelector;button.classList.remove("loading");button.setAttribute("disabled","false")}function initModalEvents(){const modals=document.querySelectorAll(".traduire-sans-migraine-modal");modals.forEach(modal=>{if(!(modal instanceof HTMLElement)){return}if(modal.dataset.initiliazed){return}modal.dataset.initiliazed="true";const closeBtn=modal.querySelector(".traduire-sans-migraine-modal__content-header-close");closeBtn.addEventListener("click",()=>{removeModal(modal.parentElement)})})}function addModalToBody(modalHTML){const div=document.createElement("div");div.innerHTML=modalHTML;div.id=`traduire-sans-migraine-modal-${Date.now()}`;document.body.appendChild(div);initModalEvents();return document.querySelector(`#${div.id}`)}function removeModal(modal){modal.remove()}async function renderModal(title="",message="",button=[]){const fetchResponse=await fetch(`${window.tsmVariables.url}render_modal`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:title,message:message,button:button})});const data=await fetchResponse.text();return addModalToBody(data)}class TSM_Notification{static createNode(title,message,logo,type){const notification=document.createElement("div");notification.classList.add("traduire-sans-migraine-notification",`traduire-sans-migraine-notification-${type}`);notification.innerHTML=`<div class="traduire-sans-migraine-notification__close">X</div>
                ${logo?`<div class="traduire-sans-migraine-notification__logo">
                    <img src="${window.tsmVariables.assetsURI}${logo}" alt="Traduire Sans Migraine" width="58px">
                </div>`:""}
                <div class="traduire-sans-migraine-notification__body">
                    <h3 class="traduire-sans-migraine-notification__title">${window.tsmI18N&&title in window.tsmI18N?window.tsmI18N[title]:title}</h3>
                    <p class="traduire-sans-migraine-notification__message">${window.tsmI18N&&message in window.tsmI18N?window.tsmI18N[message]:message}</p>
                </div>
        `;return notification}static getContainer(location){if(!location.querySelector(".traduire-sans-migraine-notification-container")){const container=document.createElement("div");container.classList.add("traduire-sans-migraine-notification-container");const opener=document.createElement("div");opener.classList.add("traduire-sans-migraine-notification-opener");opener.innerHTML=`<img src="${window.tsmVariables.assetsURI}loutre_ampoule.png" alt="Traduire Sans Migraine" width="58px">`;opener.addEventListener("click",()=>{opener.classList.remove("visible");container.querySelectorAll(".traduire-sans-migraine-notification").forEach(notification=>{notification.classList.remove("traduire-sans-migraine-notification--hidden")})});container.prepend(opener);location.appendChild(container)}return location.querySelector(".traduire-sans-migraine-notification-container")}static removeContainerIfEmpty(location){const container=location.querySelector(".traduire-sans-migraine-notification-container");if(container&&!container.hasChildNodes()){location.removeChild(container)}}static displayContainerOpener(location){const container=location.querySelector(".traduire-sans-migraine-notification-container");if(container){container.querySelector(".traduire-sans-migraine-notification-opener").classList.add("visible")}}static show(title,message,logo,type,persist=false,location=document.body){const notification=TSM_Notification.createNode(title,message,logo,type);TSM_Notification.getContainer(location).prepend(notification);let timeOutId=null;if(!persist){timeOutId=setTimeout(()=>{notification.classList.add("traduire-sans-migraine-notification--hiddenAnimation");setTimeout(()=>{if(notification.parentNode){notification.parentNode.removeChild(notification)}TSM_Notification.removeContainerIfEmpty(location)},800)},8e3)}notification.querySelector(".traduire-sans-migraine-notification__close").addEventListener("click",()=>{if(!persist){if(timeOutId){clearTimeout(timeOutId)}if(notification.parentNode){notification.parentNode.removeChild(notification)}TSM_Notification.removeContainerIfEmpty(location)}else{notification.classList.add("traduire-sans-migraine-notification--hiddenAnimation");setTimeout(()=>{notification.classList.remove("traduire-sans-migraine-notification--hiddenAnimation");notification.classList.add("traduire-sans-migraine-notification--hidden");TSM_Notification.displayContainerOpener(location)},800)}})}}function setStep({percentage,html,div,status="progress"}){const indicatorPercentage=div.querySelector(".indicator-percentage");const indicatorHtml=div.querySelector(".indicator-text");const progressBar=div.querySelector(".progress-bar");const progressBarFill=progressBar.querySelector(".progress-bar-fill");indicatorHtml.innerHTML=html;if(indicatorPercentage instanceof HTMLElement){indicatorPercentage.innerText=`${percentage}%`}if(progressBarFill instanceof HTMLElement){progressBarFill.style.width=`${percentage}%`}progressBarFill.classList.remove("progress-bar-fill--progress","progress-bar-fill--done","progress-bar-fill--error");progressBarFill.classList.add(`progress-bar-fill--${status}`)}const TSMTooltips={};function initTooltips(){const tooltips=document.querySelectorAll(".traduire-sans-migraine-tooltip");tooltips.forEach(tooltip=>{if(!(tooltip instanceof HTMLElement)){return}if(tooltip.dataset.initilized==="true"){return}tooltip.dataset.initilized="true";const realContent=tooltip.querySelector(".traduire-sans-migraine-tooltip-hoverable");const tooltipContent=tooltip.querySelector(".traduire-sans-migraine-tooltip-content");let copy=null;realContent.addEventListener("mouseenter",()=>{if(copy){return}const rect=realContent.getBoundingClientRect();const positionX=rect.x+window.scrollX;const positionY=rect.y+rect.height+window.scrollY;copy=createDOMAtTheEnd(tooltipContent,positionX,positionY);copy.addEventListener("mouseleave",functionToRemoveTooltip);TSMTooltips[copy.id]=realContent});const functionToRemoveTooltip=async()=>{await new Promise(resolve=>setTimeout(resolve,100));if(!copy){return}if(realContent.matches(":hover")||tooltipContent.matches(":hover")||copy.matches(":hover")){return}const copyId=copy.id;delete TSMTooltips[copyId];copy.remove();copy=null};realContent.addEventListener("mouseleave",functionToRemoveTooltip)});for(const copyId of Object.keys(TSMTooltips)){const realContent=TSMTooltips[copyId];if(document.contains(realContent)===false){const copy=document.querySelector(`#${copyId}`);if(copy){copy.remove();delete TSMTooltips[copyId]}}}}function createDOMAtTheEnd(div,positionX,positionY){const copy=div.cloneNode(true);if(!(copy instanceof HTMLElement)){return}copy.id=`tooltip-${Date.now()}${Math.floor(Math.random()*1e4)}`;copy.style.position="absolute";copy.style.left=`${positionX}px`;copy.style.top=`${positionY}px`;copy.classList.add("traduire-sans-migraine-tooltip-content--visible");document.body.appendChild(copy);return document.body.querySelector(`#${copy.id}`)}async function tsmHandleRequestResponse(response,onError,onSuccess){if(response.status>=400){const{data}=await response.json();if(!data){return onError(response,data)}TSM_Notification.show(data.title,data.message,data.logo,"error");return onError(response)}return onSuccess(response)}function getQuery(queryName){const url=window.location.href;const urlObj=new URL(url);return urlObj.searchParams.get(queryName)}{}async function deleteTranslations(modal,id){const contentModal=modal.querySelector(".traduire-sans-migraine-modal__content-body-text");const fetchResponse=await fetch(`${window.tsmVariables.url}article_deleted_delete_translations&post_id=${id}`);const data=await fetchResponse.json();if(!data.success){const div=document.createElement("div");div.id="result";if(contentModal.querySelector("#result")){contentModal.querySelector("#result").remove()}div.innerHTML=data.data.html;contentModal.append(div);return}contentModal.innerHTML=data.data.html}async function loadModalTraduireSansMigraineForTrash(id){const fetchResponse=await fetch(`${window.tsmVariables.url}article_deleted_render&post_id=${id}`);if(fetchResponse.status>=400){return}const data=await fetchResponse.text();const modal=addModalToBody(data);const noButton=modal.querySelector("#no-button");const yesButton=modal.querySelector("#yes-button");noButton.addEventListener("click",e=>{e.preventDefault();removeModal(modal)});yesButton.addEventListener("click",async e=>{e.preventDefault();setButtonLoading(yesButton);setButtonLoading(noButton);await deleteTranslations(modal,id);stopButtonLoading(yesButton);stopButtonLoading(noButton)})}(()=>{if(!("trashed"in window.tsmVariables)||!("ids"in window.tsmVariables)||!window.tsmVariables.trashed||typeof window.tsmVariables.ids!=="string"){return}const ids=window.tsmVariables.ids.split(",");if(ids.length>1){return}loadModalTraduireSansMigraineForTrash(ids[0])})();console.log("Traduire-Sans-Migraine Editor");function getCheckboxesListChecked(modal){return modal.querySelectorAll("input[type='checkbox']:not([id='global-languages']):not([disabled]):checked")}function getCheckboxesList(modal){return modal.querySelectorAll("input[type='checkbox']:not([id='global-languages']):not([disabled])")}function displayCountCheckedToButton(modal){const checkedCheckboxes=getCheckboxesListChecked(modal);const buttonTranslate=modal.querySelector("#translate-button");if(!(buttonTranslate instanceof HTMLButtonElement)){return}if(checkedCheckboxes.length>0){buttonTranslate.disabled=false;buttonTranslate.classList.remove("disabled");buttonTranslate.innerHTML=`${buttonTranslate.dataset.default} (${checkedCheckboxes.length})`}else{buttonTranslate.disabled=true;buttonTranslate.classList.add("disabled")}}async function displayLogInSection(modal,callbackOnLoggedIn){const modalContent=modal.querySelector(".traduire-sans-migraine-modal__content-body-text");if(modalContent.querySelector("#login-container")){return}setButtonLoading("#translate-button");const logInDiv=document.createElement("div");logInDiv.id="login-container";modalContent.prepend(logInDiv);await renderLogInHTML(modal.querySelector("#login-container"),callbackOnLoggedIn);stopButtonLoading("#translate-button")}function removeLogInSection(modal){const logInDiv=modal.querySelector("#login-container");if(logInDiv){logInDiv.remove()}}function getStepList(modal,language){return modal.querySelector(`.language[data-language="${language}"] .right-column .traduire-sans-migraine-step`)}async function sendRequest(modal,language){return tsmHandleRequestResponse(await fetch(`${window.tsmVariables.url}editor_start_translate&post_id=${getQuery("post")}&language=${language}`),data=>{const stepDiv=getStepList(modal,language);setStep({percentage:100,div:stepDiv,status:"error",html:typeof data.error==="string"?data.error:data.error.message.join("<br>")});return false},async fetchResponse=>{const data=await fetchResponse.json();console.log({data:data});const stepDiv=getStepList(modal,language);if(!data.success||!("data"in data)||!("tokenId"in data.data)){setStep({percentage:100,div:stepDiv,status:"error",html:typeof data.error==="string"?data.error:typeof data.error.message==="string"?data.error.message:data.error.message.join("<br>")});return false}return data.data.tokenId})}async function sendRequests(modal,languages){const response=await Promise.all(languages.map(async language=>{const tokenId=await sendRequest(modal,language);if(!tokenId){return false}return{modal:modal,tokenId:tokenId,language:language}}));if(response.every(r=>r===false)){return}TSM_Notification.show("Traduction en cours","La traduction est en cours, vous pouvez fermer cette fenêtre et continuer à travailler sur votre site.","loutre_docteur_no_shadow.png","success");await Promise.all(response.map(({modal,tokenId,language})=>{return fetchStateTranslateUntilOver(modal,tokenId,language)}))}async function fetchStateTranslateUntilOver(modal,tokenId,language){const stepDiv=getStepList(modal,language);await tsmHandleRequestResponse(await fetch(`${window.tsmVariables.url}editor_get_state_translate&tokenId=${tokenId}`),()=>{},async fetchResponse=>{const data=await fetchResponse.json();if(!data.success||!("data"in data)){setStep({percentage:100,div:stepDiv,status:"error",html:data.error});return}const{percentage,status,html}=data.data;setStep({percentage:percentage,div:stepDiv,status:status,html:html});if(status==="error"||+percentage===100){return}await new Promise(resolve=>setTimeout(resolve,1500));return fetchStateTranslateUntilOver(modal,tokenId,language)})}async function sendRequestPrepare(modal,languages){const body={post_id:getQuery("post"),languages:languages};return tsmHandleRequestResponse(await fetch(`${window.tsmVariables.url}editor_prepare_translate`,{method:"POST",body:JSON.stringify(body)}),()=>{return false},async fetchResponse=>{const data=await fetchResponse.json();if(!data.success){const alert=Alert.createNode("",data.error,"error");modal.querySelector(".traduire-sans-migraine-modal__content-body-text").prepend(alert)}return data.success})}function addListenerToButtonTranslate(modal){const buttonTranslate=modal.querySelector("#translate-button");buttonTranslate.addEventListener("click",async e=>{e.preventDefault();if(buttonTranslate.dataset.logged==="false"){await displayLogInSection(modal,()=>{removeLogInSection(modal);buttonTranslate.dataset.logged="true";buttonTranslate.click()});return}const checkedCheckboxes=getCheckboxesListChecked(modal);const languages=[];checkedCheckboxes.forEach(checkbox=>{languages.push(checkbox.id)});modal.querySelectorAll("input[type='checkbox']").forEach(checkbox=>{checkbox.disabled=true});setButtonLoading("#translate-button");const prepareIsSuccess=await sendRequestPrepare(modal,languages);if(prepareIsSuccess){modal.querySelector("#global-languages-section").remove();modal.querySelectorAll("input[type='checkbox']").forEach(checkbox=>{if(checkbox.checked){checkbox.disabled=true}else{checkbox.closest(".language").remove()}});await sendRequests(modal,languages)}else{modal.querySelectorAll("input[type='checkbox']").forEach(checkbox=>{checkbox.disabled=false})}stopButtonLoading("#translate-button")})}function addListenerToButtonTranslateLater(modal){const buttonTranslateLater=modal.querySelector("#closing-button");buttonTranslateLater.addEventListener("click",e=>{e.preventDefault();removeModal(modal)})}function injectFunctionTranslationModal(modal){if(!modal.querySelector("#translate-button")){return}addListenerToCheckboxes(modal);displayCountCheckedToButton(modal);addListenerToButtonTranslate(modal);addListenerToButtonTranslateLater(modal);addListenerToButtonDebug(modal);initTooltips()}function addListenerToButtonDebug(modal){const debugButton=modal.querySelector("#debug-button");if(!debugButton){return}const handleClickDebugButton=async e=>{e.preventDefault();const code=prompt("Un code vous a été fournis par notre équipe, veuillez le copier et le coller ici :");if(!code){return}setButtonLoading(debugButton);await tsmHandleRequestResponse(await fetch(`${window.tsmVariables.url}editor_debug&post_id=${getQuery("post")}&code=${code}`),()=>{},async fetchResponse=>{const data=await fetchResponse.json();if(data.success){TSM_Notification.show(data.data.title,data.data.message,data.data.logo,"success")}});stopButtonLoading(debugButton)};debugButton.addEventListener("click",handleClickDebugButton)}function addListenerToCheckboxes(modal){const handleOnChange=checkbox=>{displayCountCheckedToButton(modal);const column=checkbox.closest(".language").querySelector(".right-column");if(checkbox.checked){column.querySelector(":scope > .notice").classList.add("hidden");column.querySelector(".traduire-sans-migraine-step").classList.remove("hidden")}else{column.querySelector(".traduire-sans-migraine-step").classList.add("hidden");column.querySelector(":scope > .notice").classList.remove("hidden")}};const allCheckboxes=getCheckboxesList(modal);const globalCheckbox=modal.querySelector("#global-languages");if(!(globalCheckbox instanceof HTMLInputElement)){return}const updateDisplayGlobalCheckbox=()=>{const checkedCheckboxes=getCheckboxesListChecked(modal).length;globalCheckbox.checked=allCheckboxes.length===checkedCheckboxes;globalCheckbox.indeterminate=checkedCheckboxes>0&&!globalCheckbox.checked};globalCheckbox.addEventListener("change",()=>{allCheckboxes.forEach(checkbox=>{checkbox.checked=globalCheckbox.checked;handleOnChange(checkbox)})});allCheckboxes.forEach(checkbox=>{checkbox.addEventListener("change",()=>{handleOnChange(checkbox);updateDisplayGlobalCheckbox()})});updateDisplayGlobalCheckbox()}async function loadModalTraduireSansMigraine(){setButtonLoading("#display-traduire-sans-migraine-button");await tsmHandleRequestResponse(await fetch(`${window.tsmVariables.url}editor_onSave_render&post_id=${getQuery("post")}`),response=>{stopButtonLoading("#display-traduire-sans-migraine-button")},async response=>{const data=await response.text();const modal=addModalToBody(data);injectFunctionTranslationModal(modal);stopButtonLoading("#display-traduire-sans-migraine-button")})}if(window.tsmVariables&&window.tsmVariables._tsm_first_visit_after_translation==="true"){TSM_Notification.show("successTranslationFirstShowTitle","successTranslationFirstShow","loutre_docteur_no_shadow.png","success",true)}if(window&&window.wp&&window.wp.data&&window.wp.data.dispatch("core/editor")){if(window.tsmVariables.autoOpen==="true"){const editor=window.wp.data.dispatch("core/editor");const savePost=editor.savePost;editor.savePost=function(options){options=options||{};return savePost(options).then(()=>{if(!options.isAutosave){loadModalTraduireSansMigraine()}})}}const moveButtonToHeader=()=>{const headerElement=document.querySelector(".edit-post-header__settings");if(headerElement){const button=document.querySelector("#display-traduire-sans-migraine-button");headerElement.appendChild(button);document.querySelector("#metaboxTraduireSansMigraine").remove()}else{setTimeout(moveButtonToHeader,100)}};moveButtonToHeader()}else{if(getQuery("tsmShow")==="on"){window.history.replaceState(null,"",window.location.href.replace("&tsmShow=on","").replace("tsmShow=on",""));loadModalTraduireSansMigraine()}}const buttonDisplayTraduireSansMigraine=document.querySelector("#display-traduire-sans-migraine-button");if(buttonDisplayTraduireSansMigraine){buttonDisplayTraduireSansMigraine.addEventListener("click",e=>{e.preventDefault();loadModalTraduireSansMigraine();return false})}function addListenerToLogInButton(callbackOnSuccess){const buttonLogIn=document.querySelector("button#log-in");if(buttonLogIn instanceof HTMLButtonElement){buttonLogIn.addEventListener("click",async()=>{const href=buttonLogIn.dataset.href;window.open(href,"_blank");startFetchingLogInStatus(callbackOnSuccess)})}}async function isOtterLoggedIn(){const fetchResponse=await fetch(`${window.tsmVariables.url}is_otter_logged_in`);const data=await fetchResponse.json();return data.logged_in}async function renderLogInHTML(element,callbackOnSuccess){const fetchResponse=await fetch(`${window.tsmVariables.url}get_log_in_html`);const data=await fetchResponse.text();element.innerHTML=data;addListenerToLogInButton(callbackOnSuccess)}function startFetchingLogInStatus(callbackOnSuccess){const interval=setInterval(async()=>{const isLoggedIn=await isOtterLoggedIn();if(isLoggedIn){clearInterval(interval);if(typeof callbackOnSuccess==="function"){callbackOnSuccess()}}},1e3)}addListenerToLogInButton(()=>{window.location.reload()});(()=>{function getCheckboxesList(){return document.querySelectorAll("input[type='checkbox']:not([id='all-posts']):not([disabled])")}function getCheckboxesListChecked(){return document.querySelectorAll("input[type='checkbox']:not([id='all-posts']):not([disabled]):checked")}function displayCountCheckedToButton(){const checkedCheckboxes=getCheckboxesListChecked().length;if(!(buttonTranslate instanceof HTMLElement)){return}if(checkedCheckboxes>1){buttonTranslate.innerHTML=buttonTranslate.dataset.defaultPlural.replace("%var%",checkedCheckboxes.toString())}else if(checkedCheckboxes===1){buttonTranslate.innerHTML=buttonTranslate.dataset.defaultSingular}else{buttonTranslate.innerHTML=buttonTranslate.dataset.defaultNone}buttonTranslate.setAttribute("disabled",(checkedCheckboxes===0).toString())}const updateDisplayGlobalCheckbox=()=>{const checkedCheckboxes=getCheckboxesListChecked().length;if(globalCheckbox instanceof HTMLElement){const checked=allCheckboxes.length===checkedCheckboxes;globalCheckbox.setAttribute("checked",checked.toString());globalCheckbox.setAttribute("indeterminate",(checkedCheckboxes>0&&!checked).toString())}displayCountCheckedToButton()};async function translatePosts(ids){const languageToHidden=document.querySelector("#languageToHidden");if(!(languageToHidden instanceof HTMLInputElement)){return}await fetch(`${window.tsmVariables.url}add_items`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ids:ids,languageTo:languageToHidden.value})})}async function getQueueHTML(page){if(!page){const pageActive=document.querySelector(".bulk-queue-pagination-item.active");if(pageActive&&pageActive instanceof HTMLElement){page=pageActive.dataset.page}else{page=1}}const response=await fetch(`${window.tsmVariables.url}display_queue&page=${page}`,{method:"GET",headers:{"Content-Type":"application/json"}});return response.text()}let queueRefreshingInterval=null;function initQueueRefreshing(){queueRefreshingInterval=setInterval(loadQueue,2e3)}async function loadQueue(page){const queueHTML=await getQueueHTML(page);const bulkQueueItems=document.querySelector(".bulk-queue-items");const isCurrentlyDisplayed=bulkQueueItems?bulkQueueItems.classList.contains("visible"):false;document.querySelector("#queue-container").innerHTML=queueHTML;if(isCurrentlyDisplayed&&document.querySelector(".bulk-queue-items")){document.querySelector(".bulk-queue-items").classList.add("visible")}addListenerToQueue();handleAutoRefreshQueue()}function handleAutoRefreshQueue(){if(isQueueProgressing()&&!queueRefreshingInterval){initQueueRefreshing()}else if(!isQueueProgressing()&&queueRefreshingInterval){stopQueueRefreshing()}}function isQueueProgressing(){const playButton=document.querySelector("span[data-action='play-queue']");const pauseButton=document.querySelector("span[data-action='pause-queue']");return playButton&&playButton.classList.contains("disable")&&pauseButton&&!pauseButton.classList.contains("disable")}function addListenerToButtonDisplayQueue(){const buttonDisplayQueue=document.querySelector("#traduire-sans-migraine-bulk-queue-display");if(buttonDisplayQueue){buttonDisplayQueue.addEventListener("click",async e=>{e.preventDefault();const isCurrentlyDisplayed=document.querySelector(".bulk-queue-items").classList.contains("visible");if(isCurrentlyDisplayed){document.querySelector(".bulk-queue-items").classList.remove("visible")}else{document.querySelector(".bulk-queue-items").classList.add("visible")}})}}function stopQueueRefreshing(){clearInterval(queueRefreshingInterval)}function addListenerToQueue(){initTooltips();addListenerToButtonDisplayQueue();addListenerToActionsItems();addListenerToPagination()}function addListenerToPagination(){document.querySelectorAll(".bulk-queue-pagination-item").forEach(item=>{if(!(item instanceof HTMLElement)){return}if(item.classList.contains("active")||item.classList.contains("disable")){return}item.addEventListener("click",async e=>{e.preventDefault();const page=item.dataset.page;await loadQueue(page)})})}function addListenerToActionsItems(){document.querySelectorAll("span[data-action]").forEach(span=>{if(!(span instanceof HTMLElement)){return}if("initialized"in span.dataset){return}span.dataset.initialized="true";span.addEventListener("click",async e=>{e.preventDefault();const action=span.dataset.action;if(span.classList.contains("disable")){return}span.classList.add("disable");let response=null;if(action==="remove-from-queue"){const postId=span.dataset.postId;if(!postId){return}response=await removeItemFromQueue(postId)}else if(action==="play-queue"){response=await playQueue()}else if(action==="pause-queue"){response=await pauseQueue()}else if(action==="delete-queue"){response=await deleteQueue()}if(response){if(await tsmHandleRequestResponse(response,()=>{return false},async r=>{const{data,success}=await response.json();TSM_Notification.show(data.title,data.message,data.logo,success?"success":"error");if(success){await loadQueue()}return success})===false){span.classList.remove("disable")}}})})}async function removeItemFromQueue(postId){return fetch(`${window.tsmVariables.url}remove_item&postId=${postId}`,{method:"DELETE",headers:{"Content-Type":"application/json"}})}async function playQueue(){return fetch(`${window.tsmVariables.url}restart_queue`,{method:"PUT",headers:{"Content-Type":"application/json"}})}async function pauseQueue(){return fetch(`${window.tsmVariables.url}pause_queue`,{method:"PUT",headers:{"Content-Type":"application/json"}})}async function deleteQueue(){return fetch(`${window.tsmVariables.url}delete_queue`,{method:"DELETE",headers:{"Content-Type":"application/json"}})}const allCheckboxes=getCheckboxesList();const globalCheckbox=document.querySelector("#all-posts");const buttonTranslate=document.querySelector("#traduire-sans-migraine-bulk-translate");if(globalCheckbox){globalCheckbox.addEventListener("change",()=>{allCheckboxes.forEach(checkbox=>{checkbox.setAttribute("checked",globalCheckbox.getAttribute("checked"));displayCountCheckedToButton()})})}let lastChecked=null;allCheckboxes.forEach(checkbox=>{const handleOnChange=()=>{displayCountCheckedToButton();updateDisplayGlobalCheckbox()};checkbox.addEventListener("change",handleOnChange);checkbox.addEventListener("click",e=>{if(!(e instanceof MouseEvent)){return}if(!(checkbox instanceof HTMLElement)){return}if(e.shiftKey){let inBetween=false;allCheckboxes.forEach(checkbox=>{if(checkbox===lastChecked||checkbox===e.target){inBetween=!inBetween}if(inBetween){checkbox.setAttribute("checked",lastChecked.getAttribute("checked"));handleOnChange()}})}lastChecked=checkbox})});updateDisplayGlobalCheckbox();if(buttonTranslate){buttonTranslate.addEventListener("click",async e=>{e.preventDefault();const checkedCheckboxes=getCheckboxesListChecked();if(checkedCheckboxes.length===0){return}const ids=Array.from(checkedCheckboxes).map(checkbox=>checkbox.id.replace("post-",""));setButtonLoading(buttonTranslate);await translatePosts(ids);await loadQueue();stopButtonLoading(buttonTranslate)})}addListenerToQueue();handleAutoRefreshQueue()})();(()=>{const myAccount=document.querySelector("#my-account");if(myAccount&&myAccount instanceof HTMLElement){myAccount.addEventListener("click",()=>{const href=myAccount.dataset.href;window.open(href,"_blank")})}const contactMe=document.querySelector("#contact-me");if(contactMe&&contactMe instanceof HTMLElement){contactMe.addEventListener("click",()=>{const href=contactMe.dataset.href;window.open(href,"_blank")})}})();(()=>{const buttonSave=document.querySelector("#save-settings");if(buttonSave&&buttonSave instanceof HTMLElement){buttonSave.addEventListener("click",async()=>{const settings=new FormData;document.querySelector(".settings").querySelectorAll("input, select").forEach(input=>{if(!(input instanceof HTMLInputElement)){return}settings.append(input.id,input.checked?"true":"false")});setButtonLoading("#save-settings");const fetchResponse=await fetch(`${window.tsmVariables.url}update_settings`,{method:"POST",body:settings});const data=await fetchResponse.json();const alert=!data.success?Alert.createNode("",data.error,"error"):Alert.createNode("",data.data,"success");buttonSave.parentNode.appendChild(alert);setTimeout(()=>{alert.parentNode.removeChild(alert)},2500);stopButtonLoading("#save-settings")})}const buttonUpgrade=document.querySelector("#upgrade-quota");if(buttonUpgrade&&buttonUpgrade instanceof HTMLElement){buttonUpgrade.addEventListener("click",async()=>{const href=buttonUpgrade.dataset.href;window.open(href,"_blank")})}initTooltips()})();{}